import os
import openai
import re

openai.api_key = 'your-api-key'

# Define the directory structure
dirs = [
    "notebooks",
    os.path.join("src", "reconnaissance"),
    os.path.join("src", "vulnerability_assessment"),
    os.path.join("src", "exploitation"),
    os.path.join("src", "post_exploitation"),
    os.path.join("src", "reporting"),
]

# Define the files in each directory
files = {
    "": ["README.md", "requirements.txt", "setup.py"],
    "notebooks": ["data_analysis.ipynb", "pentesting_workflow.ipynb"],
    os.path.join("src", "reconnaissance"): ["__init__.py", "scan_network.py", "enumerate_services.py"],
    os.path.join("src", "vulnerability_assessment"): ["__init__.py", "vulnerability_scan.py", "vulnerability_analysis.py"],
    os.path.join("src", "exploitation"): ["__init__.py", "exploit_vulnerabilities.py"],
    os.path.join("src", "post_exploitation"): ["__init__.py", "gather_evidence.py", "clean_up.py"],
    os.path.join("src", "reporting"): ["__init__.py", "generate_report.py"],
}

# Create each directory if it doesn't already exist
for dir in dirs:
    if not os.path.exists(dir):
        os.makedirs(dir)

# Create each file if it doesn't already exist
for dir, filenames in files.items():
    for filename in filenames:
        filepath = os.path.join(dir, filename)
        if not os.path.exists(filepath):
            with open(filepath, 'w') as f:
                if filename.endswith('.py'):
                    # Create a prompt for the OpenAI API based on the filename
                    prompt = f"""
                    - system: You are a helpful assistant that writes Python code.
                    - user: I need you to write a Python script for a file named {filename}. The script should be efficient and follow best practices.
                    """
                    response = openai.Completion.create(engine="text-davinci-003", prompt=prompt, max_tokens=150, temperature=0.3)
                    # Extract the content inside the code box
                    matches = re.findall(r'```python(.*?)```', response.choices[0].text.strip(), re.DOTALL)
                    if matches:
                        # Write the OpenAI API's response to the file
                        f.write(matches[0].strip())
